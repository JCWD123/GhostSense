# ğŸš¨ æ¥å£ URL ä¿®å¤ - å¿«é€ŸæŒ‡å—

> å¦‚æœé‡åˆ° **404 é”™è¯¯** æˆ– **è¯„è®ºæŠ“å–å¤±è´¥**ï¼Œè¯·é˜…è¯»æœ¬æŒ‡å—

---

## âš¡ ä¸€åˆ†é’Ÿå¿«é€Ÿä¿®å¤

### é—®é¢˜ç—‡çŠ¶

```log
âŒ è·å–ç¬”è®°è¯¦æƒ…å¤±è´¥: 404
âŒ è¯„è®ºæ¥å£å¤±è´¥: 404 æˆ–è¶…æ—¶
âš ï¸ è¯¦æƒ…é¡µå“åº”ä¸­æœªæ‰¾åˆ° xsec_token
```

### ä¿®å¤æ–¹æ³•

âœ… **å·²è‡ªåŠ¨ä¿®å¤**ï¼ˆæœ€æ–°ç‰ˆæœ¬ï¼‰

å¦‚æœä½ åˆšæ‹‰å–äº†æœ€æ–°ä»£ç ï¼Œæ¥å£ URL å·²ç»è‡ªåŠ¨æ›´æ–°ï¼š

```bash
# 1. ç¡®è®¤ä»£ç æ˜¯æœ€æ–°çš„
git pull origin main

# 2. é‡å¯æœåŠ¡
cd backend && python main.py       # ç»ˆç«¯ 1
cd signature-service && npm run dev  # ç»ˆç«¯ 2

# 3. æµ‹è¯•æ–°æ¥å£
cd backend && python test_new_api_urls.py
```

---

## ğŸ” æ¥å£å˜æ›´è¯¦æƒ…

### å˜æ›´ 1: è¯¦æƒ…æ¥å£

| é¡¹ç›® | æ—§å€¼ | æ–°å€¼ |
|------|------|------|
| URL | `/api/sns/web/v1/note/detail` | `/api/sns/web/v1/feed` |
| å‚æ•° | `note_id` | `source_note_id` |
| å“åº” | `data.note_info` | `data.items[0].note_card` |

**ç¤ºä¾‹**:
```python
# âŒ æ—§ä»£ç 
data = {"note_id": "xxx"}

# âœ… æ–°ä»£ç 
data = {"source_note_id": "xxx"}
```

### å˜æ›´ 2: è¯„è®ºæ¥å£

| é¡¹ç›® | æ—§å€¼ | æ–°å€¼ |
|------|------|------|
| åŸŸå | `edith.xiaohongshu.com` | `t2.xiaohongshu.com` |
| URL | `/api/sns/web/v2/comment/page` | `/api/v2/collect` |

**ç¤ºä¾‹**:
```python
# âŒ æ—§ä»£ç 
url = "https://edith.xiaohongshu.com/api/sns/web/v2/comment/page"

# âœ… æ–°ä»£ç 
url = "https://t2.xiaohongshu.com/api/v2/collect"
```

---

## ğŸ§ª éªŒè¯ä¿®å¤

### æ–¹æ³•1: è¿è¡Œæµ‹è¯•è„šæœ¬

```bash
cd backend
python test_new_api_urls.py
```

**é¢„æœŸè¾“å‡º**:
```
âœ… è¯¦æƒ…æ¥å£æµ‹è¯•æˆåŠŸ!
âœ… xsec_token è·å–æˆåŠŸ!
âœ… è¯„è®ºæ¥å£æµ‹è¯•æˆåŠŸ!
ğŸ‰ æ‰€æœ‰æ¥å£æµ‹è¯•é€šè¿‡ï¼
```

### æ–¹æ³•2: æŸ¥çœ‹æ—¥å¿—

```bash
# å¯åŠ¨åç«¯åï¼ŒæŸ¥çœ‹æ—¥å¿—
tail -f backend/logs/app.log | grep "è¯¦æƒ…\|è¯„è®º"
```

**æ­£å¸¸æ—¥å¿—**:
```log
ğŸ“ è¯·æ±‚ç¬”è®°è¯¦æƒ…: xxx
âœ… è¯¦æƒ…æ¥å£æˆåŠŸ
ğŸ”‘ æˆåŠŸè·å– xsec_token
ğŸ’¬ è¯„è®ºæ¥å£æˆåŠŸ
âœ… æˆåŠŸè·å–è¯„è®º: xxx (15 æ¡)
```

**å¼‚å¸¸æ—¥å¿—**:
```log
âŒ è·å–ç¬”è®°è¯¦æƒ…å¤±è´¥: xxx, å“åº”: {404}
âŒ è¯„è®ºæ¥å£å¤±è´¥: 404
```

---

## ğŸ› ä»ç„¶å¤±è´¥ï¼Ÿ

### æ£€æŸ¥æ¸…å•

#### 1. ç¡®è®¤ä»£ç å·²æ›´æ–°

```bash
cd backend/crawler
grep "source_note_id" xhs_client.py
```

åº”è¯¥çœ‹åˆ°ï¼š
```python
data = {
    "source_note_id": note_id,  # æ­£ç¡®
    ...
}
```

å¦‚æœçœ‹åˆ°çš„æ˜¯ `"note_id": note_id`ï¼Œè¯´æ˜ä»£ç æœªæ›´æ–°ã€‚

#### 2. ç¡®è®¤ç­¾åæœåŠ¡è¿è¡Œ

```bash
curl http://localhost:3100/health
```

åº”è¯¥è¿”å›ï¼š
```json
{
  "success": true,
  "service": "MediaCrawler Signature Service",
  "version": "2.0.0"
}
```

#### 3. æ£€æŸ¥ Electron

è¯„è®ºæ¥å£éœ€è¦ Electronï¼ˆæµè§ˆå™¨å†…æ‰§è¡Œæ¨¡å¼ï¼‰ï¼š

```bash
curl http://localhost:9222/json/version
```

å¦‚æœè¿”å› 404ï¼Œè¯´æ˜ Electron æœªè¿è¡Œæˆ–ç«¯å£ä¸å¯¹ã€‚

**è§£å†³**:
```bash
cd frontend
npm run dev
```

#### 4. ä¸´æ—¶ç¦ç”¨æµè§ˆå™¨å†…æ‰§è¡Œ

å¦‚æœ Electron æœ‰é—®é¢˜ï¼Œå¯ä»¥æš‚æ—¶ç¦ç”¨ï¼š

```python
# backend/core/config.py
USE_BROWSER_EXECUTE_FOR_COMMENTS = False
```

é‡å¯åç«¯ï¼Œè¯„è®ºæ¥å£ä¼šä½¿ç”¨æ™®é€š HTTP æ¨¡å¼ï¼ˆæˆåŠŸç‡è¾ƒä½ï¼‰ã€‚

---

## ğŸ“‹ å®Œæ•´ä¿®å¤æ­¥éª¤

å¦‚æœä¸Šè¿°å¿«é€Ÿä¿®å¤ä¸ç”Ÿæ•ˆï¼Œè¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š

### Step 1: åœæ­¢æ‰€æœ‰æœåŠ¡

```bash
# æŒ‰ Ctrl+C åœæ­¢æ‰€æœ‰ç»ˆç«¯
```

### Step 2: æ‹‰å–æœ€æ–°ä»£ç 

```bash
git pull origin main
```

### Step 3: æ£€æŸ¥å…³é”®æ–‡ä»¶

```bash
# æ£€æŸ¥è¯¦æƒ…æ¥å£
grep -A 5 "def get_note_detail" backend/crawler/xhs_client.py

# åº”è¯¥çœ‹åˆ°ï¼š
# uri = "/api/sns/web/v1/feed"
# data = {
#     "source_note_id": note_id,
#     ...
# }
```

```bash
# æ£€æŸ¥è¯„è®ºæ¥å£
grep -A 3 "comment_base_url" backend/crawler/xhs_client.py

# åº”è¯¥çœ‹åˆ°ï¼š
# comment_base_url = "https://t2.xiaohongshu.com"
# uri = "/api/v2/collect"
```

### Step 4: é‡æ–°å®‰è£…ä¾èµ–ï¼ˆå¯é€‰ï¼‰

```bash
cd backend
pip install -r requirements.txt

cd ../signature-service
npm install
```

### Step 5: å¯åŠ¨æ‰€æœ‰æœåŠ¡

```bash
# ç»ˆç«¯ 1
cd backend
python main.py

# ç»ˆç«¯ 2
cd signature-service
npm run dev

# ç»ˆç«¯ 3
cd frontend
npm run dev
```

### Step 6: è¿è¡Œæµ‹è¯•

```bash
cd backend
python test_new_api_urls.py
```

### Step 7: åˆ›å»ºä»»åŠ¡æµ‹è¯•

1. Electron ä¸­æ‰«ç ç™»å½•
2. åˆ›å»ºæœç´¢ä»»åŠ¡
3. å‹¾é€‰"çˆ¬å–è¯„è®º"
4. å¯åŠ¨ä»»åŠ¡
5. è§‚å¯Ÿæ—¥å¿—

---

## ğŸ†˜ è”ç³»æ”¯æŒ

å¦‚æœä»¥ä¸Šæ­¥éª¤éƒ½æ— æ³•è§£å†³é—®é¢˜ï¼š

1. **æŸ¥çœ‹è¯¦ç»†æ–‡æ¡£**: `æ¥å£URLä¿®å¤è¯´æ˜-V3.1.md`
2. **æ£€æŸ¥æ—¥å¿—**: `backend/logs/app.log`
3. **æä¾›ä¿¡æ¯**:
   - é”™è¯¯æ—¥å¿—ï¼ˆå®Œæ•´ï¼‰
   - æµ‹è¯•è„šæœ¬è¾“å‡º
   - é…ç½®æ–‡ä»¶ï¼ˆ`config.py`ï¼‰
   - Python ç‰ˆæœ¬ã€Node ç‰ˆæœ¬

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- ğŸ“˜ [æ¥å£URLä¿®å¤è¯´æ˜-V3.1.md](./æ¥å£URLä¿®å¤è¯´æ˜-V3.1.md) - è¯¦ç»†æŠ€æœ¯è¯´æ˜
- ğŸ“— [Proç‰ˆä¼˜åŒ–å®Œæˆè¯´æ˜-V3.md](./Proç‰ˆä¼˜åŒ–å®Œæˆè¯´æ˜-V3.md) - V3 ç‰ˆæœ¬å®Œæ•´æ–‡æ¡£
- ğŸ“™ [å¿«é€Ÿå¼€å§‹-V3ä¼˜åŒ–ç‰ˆ.md](./å¿«é€Ÿå¼€å§‹-V3ä¼˜åŒ–ç‰ˆ.md) - å¿«é€Ÿä¸Šæ‰‹æŒ‡å—

---

## âœ… ç¡®è®¤ä¿®å¤æˆåŠŸ

å½“ä½ çœ‹åˆ°ä»¥ä¸‹æ—¥å¿—ï¼Œè¯´æ˜ä¿®å¤æˆåŠŸï¼š

```log
ğŸ“ è¯·æ±‚ç¬”è®°è¯¦æƒ…: 68303bbb000000002100f85c
âœ… è¯¦æƒ…æ¥å£æˆåŠŸ
   æ ‡é¢˜: æ­å·åŠ³åŠ¨ä»²è£æ¡ˆä¾‹
   ä½œè€…: æŸç”¨æˆ·

ğŸ”‘ æˆåŠŸè·å– xsec_token: 68303bbb000000002100f85c
   Token: ABC123XYZ...
   Source: pc_feed

ğŸ’¬ è¯„è®ºæ¥å£æˆåŠŸ
   è¯„è®ºæ•°: 15
   ç¬¬ä¸€æ¡: è¿™ä¸ªæ¡ˆä¾‹å¾ˆæœ‰å‚è€ƒä»·å€¼...

âœ… æˆåŠŸçˆ¬å–è¯„è®º: 68303bbb000000002100f85c (15 æ¡)
```

ğŸ‰ æ­å–œï¼æ¥å£å·²ä¿®å¤ï¼Œå¯ä»¥æ­£å¸¸ä½¿ç”¨äº†ï¼

