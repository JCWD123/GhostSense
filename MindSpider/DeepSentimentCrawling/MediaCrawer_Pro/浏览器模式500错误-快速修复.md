# âš¡ æµè§ˆå™¨æ¨¡å¼500é”™è¯¯ - å¿«é€Ÿä¿®å¤æŒ‡å—

## ğŸ¯ é—®é¢˜

Pythonåç«¯æŠ¥é”™ï¼š
```
âŒ æµè§ˆå™¨æ¨¡å¼å‡ºé”™: Server error '500 Internal Server Error' 
for url 'http://localhost:3100/sign/xhs/browser'
```

---

## âœ… å¿«é€Ÿä¿®å¤ï¼ˆ3æ­¥ï¼‰

### æ­¥éª¤1ï¼šç¡®ä¿Electronè¿è¡Œ

```bash
cd frontend
npm run electron:dev
```

**éªŒè¯ï¼š** åº”è¯¥çœ‹åˆ°è¾“å‡ºï¼š
```
ğŸ” è¿œç¨‹è°ƒè¯•å·²å¯ç”¨ï¼Œç«¯å£: 9222
```

### æ­¥éª¤2ï¼šéªŒè¯è°ƒè¯•ç«¯å£

```bash
curl http://localhost:9222/json/version
```

**é¢„æœŸï¼š** è¿”å›JSONæ•°æ®ï¼ˆæµè§ˆå™¨ç‰ˆæœ¬ä¿¡æ¯ï¼‰

**å¦‚æœå¤±è´¥ï¼š**
```bash
# æ£€æŸ¥ç«¯å£å ç”¨
netstat -an | grep 9222

# æ€æ­»å ç”¨è¿›ç¨‹ï¼ˆå¦‚éœ€è¦ï¼‰
# Linux/Mac: lsof -i :9222
# Windows: netstat -ano | findstr 9222
```

### æ­¥éª¤3ï¼šé‡å¯ç­¾åæœåŠ¡

```bash
cd signature-service

# å¦‚æœæ˜¯é¦–æ¬¡è¿è¡Œï¼Œå…ˆå®‰è£…ä¾èµ–
npm install

# å¯åŠ¨æœåŠ¡
npm start
```

**éªŒè¯ï¼š** çœ‹åˆ°è¾“å‡ºï¼š
```
ğŸ“¦ MediaCrawler ç­¾åæœåŠ¡å·²å¯åŠ¨
ğŸŒ ç›‘å¬åœ°å€: http://0.0.0.0:3100
```

---

## ğŸ” è¯Šæ–­å·¥å…·

è¿è¡Œè‡ªåŠ¨è¯Šæ–­è„šæœ¬ï¼š

```bash
cd signature-service
node test_browser_mode.js
```

**å¦‚æœå…¨éƒ¨é€šè¿‡ï¼š**
```
âœ“ Electronè°ƒè¯•ç«¯å£
âœ“ CDPåè®®è¿æ¥
âœ“ ç‹¬ç«‹æµè§ˆå™¨å¯åŠ¨
âœ“ å®Œæ•´æµè§ˆå™¨æ¨¡å¼

âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡ (4/4)
```

**å¦‚æœæœ‰å¤±è´¥ï¼š** æŒ‰ç…§è„šæœ¬æç¤ºæ“ä½œ

---

## ğŸ› å¸¸è§é—®é¢˜

### Q1: Electronè°ƒè¯•ç«¯å£ä¸å¯ç”¨

**å¿«é€Ÿè§£å†³ï¼š**
```bash
# 1. ç¡®è®¤é…ç½®ï¼ˆfrontend/electron/main.jsï¼‰
app.commandLine.appendSwitch('--remote-debugging-port', '9222');

# 2. é‡å¯Electron
cd frontend
npm run electron:dev
```

### Q2: Chromiumæœªå®‰è£…

**å¿«é€Ÿè§£å†³ï¼š**
```bash
cd signature-service
npx playwright install chromium
```

### Q3: CDPè¿æ¥è¶…æ—¶

**å¿«é€Ÿè§£å†³ï¼š**
```bash
# æ£€æŸ¥Electronæ˜¯å¦çœŸçš„åœ¨è¿è¡Œ
ps aux | grep electron  # Linux/Mac
tasklist | findstr electron  # Windows

# é‡å¯æ‰€æœ‰æœåŠ¡
# ç»ˆç«¯1: cd frontend && npm run electron:dev
# ç»ˆç«¯2: cd signature-service && npm start
# ç»ˆç«¯3: cd backend && python main.py
```

---

## ğŸ¯ éªŒè¯ä¿®å¤æˆåŠŸ

### æµ‹è¯•1ï¼šAPIç«¯ç‚¹æµ‹è¯•

```bash
curl -X POST http://localhost:3100/sign/xhs/browser \
  -H "Content-Type: application/json" \
  -d '{
    "url": "https://edith.xiaohongshu.com/api/sns/web/v1/search/notes",
    "method": "POST",
    "data": {"keyword": "test"},
    "cookie": "a1=xxx; webId=xxx",
    "debugPort": 9222
  }'
```

**æˆåŠŸæ ‡å¿—ï¼š**
```json
{
  "success": true,
  "data": {
    "x-s": "XYS_...",
    "x-t": "1234567890123",
    "x-s-common": "2UQAPsHC+...",  â† å¿…é¡»æœ‰ï¼
    "x-b3-traceid": "..."
  },
  "mode": "browser"
}
```

### æµ‹è¯•2ï¼šPythonåç«¯æµ‹è¯•

```bash
cd backend
python -c "
import asyncio
from crawler.xhs_client import XHSClient

async def test():
    async with XHSClient() as client:
        client.set_cookie('a1=xxx; webId=xxx; web_session=xxx')
        result = await client.search_notes('test', page=1, page_size=5)
        print('âœ… æˆåŠŸ' if result else 'âŒ å¤±è´¥')

asyncio.run(test())
"
```

**æˆåŠŸæ ‡å¿—ï¼š**
æ—¥å¿—åŒ…å«ï¼š
```
âœ… æµè§ˆå™¨æ¨¡å¼è·å–ç­¾åæˆåŠŸ:
   x-s-common: 2UQAPsHC+...  â† å¿…é¡»æœ‰ï¼
```

---

## ğŸ“‹ å®Œæ•´å¯åŠ¨é¡ºåº

```bash
# ç»ˆç«¯1ï¼šElectronï¼ˆå¿…é¡»å…ˆå¯åŠ¨ï¼ï¼‰
cd frontend
npm run electron:dev
# ç­‰å¾…ï¼šğŸ” è¿œç¨‹è°ƒè¯•å·²å¯ç”¨ï¼Œç«¯å£: 9222

# ç»ˆç«¯2ï¼šç­¾åæœåŠ¡
cd signature-service
npm start
# ç­‰å¾…ï¼šğŸ“¦ MediaCrawler ç­¾åæœåŠ¡å·²å¯åŠ¨

# ç»ˆç«¯3ï¼šPythonåç«¯
cd backend
python main.py
# ç­‰å¾…ï¼šApplication startup complete
```

---

## ğŸ‰ ä¿®å¤å®Œæˆç¡®è®¤

ä¿®å¤æˆåŠŸåï¼Œä½ åº”è¯¥èƒ½å¤Ÿï¼š

- [x] Electronæ­£å¸¸è¿è¡Œï¼ˆç«¯å£9222å¯è®¿é—®ï¼‰
- [x] è¯Šæ–­è„šæœ¬å…¨éƒ¨é€šè¿‡
- [x] APIæµ‹è¯•è¿”å›å®Œæ•´ç­¾åï¼ˆåŒ…æ‹¬x-s-commonï¼‰
- [x] Pythonåç«¯ä¸å†æŠ¥"ç™»å½•å·²è¿‡æœŸ"
- [x] å¯ä»¥æ­£å¸¸çˆ¬å–å°çº¢ä¹¦æ•°æ®

---

## ğŸ“ ä»ç„¶å¤±è´¥ï¼Ÿ

å¦‚æœä»¥ä¸Šæ­¥éª¤éƒ½åšäº†ä»ç„¶å¤±è´¥ï¼š

1. **æŸ¥çœ‹è¯¦ç»†æ—¥å¿—**
   - ç­¾åæœåŠ¡æ—¥å¿—ï¼ˆnpm startçš„è¾“å‡ºï¼‰
   - Pythonåç«¯æ—¥å¿—
   - Electronæ§åˆ¶å°ï¼ˆF12ï¼‰

2. **æ£€æŸ¥é˜²ç«å¢™**
   ```bash
   # ç¡®ä¿ç«¯å£æœªè¢«é˜²ç«å¢™é˜»æ­¢
   # 9222 (Electron)
   # 3100 (ç­¾åæœåŠ¡)
   # 8000 (Pythonåç«¯)
   ```

3. **é™çº§åˆ°ç‹¬ç«‹æµè§ˆå™¨æ¨¡å¼**
   ```python
   # backend/crawler/xhs_client.py
   # ä¿®æ”¹ sign_request æ–¹æ³•ï¼Œä¸ä¼  debugPort
   # è¿™æ ·ä¼šå¯åŠ¨ç‹¬ç«‹çš„Playwrightæµè§ˆå™¨ï¼ˆè¾ƒæ…¢ä½†æ›´ç¨³å®šï¼‰
   ```

4. **ä½¿ç”¨çº¯JSæ¨¡å¼ï¼ˆæœ€åæ‰‹æ®µï¼‰**
   ```python
   async def sign_request(self, url, data, use_browser=False):
       # æ”¹ä¸º use_browser=False
       # åªè·å– x-s å’Œ x-tï¼ˆå¯èƒ½æˆåŠŸç‡è¾ƒä½ï¼‰
   ```

---

## ğŸ“š è¯¦ç»†æ–‡æ¡£

- [å®Œæ•´ä¿®å¤æŒ‡å—](docs/æµè§ˆå™¨æ¨¡å¼500é”™è¯¯ä¿®å¤.md)
- [ç­¾åé—®é¢˜ä¿®å¤è¯´æ˜](docs/ç­¾åé—®é¢˜ä¿®å¤è¯´æ˜.md)
- [ä¿®å¤éªŒè¯æ¸…å•](ä¿®å¤éªŒè¯æ¸…å•.md)

---

**æœ€åæ›´æ–°ï¼š** 2025-11-21  
**è€—æ—¶ï¼š** çº¦5-10åˆ†é’Ÿ  
**æˆåŠŸç‡ï¼š** 95%+


