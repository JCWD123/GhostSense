# Electron 调试端口说明

## 🔍 两个调试端口的区别

### http://localhost:5173 - Vite 开发服务器（推荐）

**这是什么：**
- 前端应用实际运行的地方
- Vite 的热模块替换(HMR)服务器
- 直接在浏览器中访问

**用途：**
- ✅ 查看前端 DOM 结构
- ✅ 调试前端 JavaScript
- ✅ 查看网络请求（XHR/Fetch）
- ✅ 查看 Console 日志
- ✅ 实时查看前端错误
- ✅ 使用浏览器 DevTools 的所有功能

**如何使用：**
```bash
# 1. 启动 Vite 开发服务器
cd frontend
npm run dev

# 2. 直接在浏览器访问
浏览器打开: http://localhost:5173
```

**适用场景：**
- 📱 开发前端界面时
- 🐛 调试前端逻辑
- 🌐 查看 API 请求
- 👀 实时查看页面变化

---

### http://localhost:9222 - Electron 远程调试协议

**这是什么：**
- Electron 的 Chrome DevTools Protocol (CDP) 端点
- 用于远程调试 Electron 应用
- 不是直接在浏览器中访问的 Web 页面

**用途：**
- ✅ 通过 Chrome inspect 调试 Electron 窗口
- ✅ 调试 Electron 主进程和渲染进程
- ✅ 使用 Cursor Browser 工具连接
- ✅ 自动化测试工具连接

**如何使用：**

#### 方法 1：Chrome DevTools（推荐）
```bash
# 1. 启动 Electron 应用
cd frontend
npm run electron:dev

# 2. 打开 Chrome 浏览器
# 3. 访问 chrome://inspect/#devices
# 4. 点击 "Configure..." 添加 localhost:9222
# 5. 在列表中找到 "MediaCrawer Pro" 应用
# 6. 点击 "inspect" 开始调试
```

#### 方法 2：Cursor Browser 工具
```
1. 启动 Electron 应用
2. 在 Cursor 中使用 Browser 工具
3. 连接到调试端点（会自动检测）
```

#### 方法 3：命令行查看
```bash
# 查看可用的调试目标
curl http://localhost:9222/json

# 返回示例：
[
  {
    "description": "",
    "devtoolsFrontendUrl": "/devtools/inspector.html?ws=localhost:9222/devtools/page/xxx",
    "id": "xxx",
    "title": "MediaCrawer Pro - 自媒体数据采集系统",
    "type": "page",
    "url": "http://localhost:5173/#/dashboard",
    "webSocketDebuggerUrl": "ws://localhost:9222/devtools/page/xxx"
  }
]
```

**适用场景：**
- 🖥️ 调试 Electron 桌面应用
- 🔧 调试 Electron 主进程
- 🤖 自动化测试
- 🔌 使用专业调试工具

---

## 📊 对比表格

| 特性 | localhost:5173<br/>(Vite 开发服务器) | localhost:9222<br/>(Electron 远程调试) |
|------|-------------------------------------|--------------------------------------|
| **类型** | Web 开发服务器 | 远程调试协议端点 |
| **直接访问** | ✅ 可以直接在浏览器打开 | ❌ 不能直接访问，需要通过 DevTools |
| **查看 DOM** | ✅ 完整支持 | ✅ 通过 Chrome inspect 支持 |
| **调试 JS** | ✅ 完整支持 | ✅ 通过 Chrome inspect 支持 |
| **网络请求** | ✅ 实时查看 | ✅ 通过 Chrome inspect 支持 |
| **Console 日志** | ✅ 实时查看 | ✅ 通过 Chrome inspect 支持 |
| **热更新** | ✅ HMR 支持 | ❌ 需要手动刷新 |
| **Electron 特性** | ❌ 不支持 | ✅ 可调试主进程 |
| **使用难度** | ⭐ 简单 | ⭐⭐ 中等 |
| **推荐场景** | 前端开发和调试 | Electron 应用调试 |

---

## 🎯 实际使用建议

### 开发前端界面时 → 使用 localhost:5173

```bash
# 1. 只启动 Vite 服务器
cd frontend
npm run dev

# 2. 浏览器访问
http://localhost:5173

# 3. 打开浏览器 DevTools (F12)
# 4. 开始调试前端代码
```

**优势：**
- 热更新最快
- DevTools 功能完整
- 无需额外配置
- 直接看到前端效果

---

### 测试 Electron 桌面功能时 → 使用 localhost:9222

```bash
# 1. 启动完整的 Electron 应用
cd frontend
npm run electron:dev

# 2. 使用 Chrome DevTools 连接
chrome://inspect → 找到应用 → inspect

# 3. 调试 Electron 特有功能
# - 窗口管理
# - 主进程通信
# - 原生功能
```

**优势：**
- 调试真实 Electron 环境
- 可以调试主进程
- 测试桌面应用特性

---

## 🚨 常见问题

### Q1: 为什么 9222 端口看不到网络请求？

**A:** 因为你需要通过 Chrome DevTools 连接到 Electron，而不是直接访问 `http://localhost:9222`。

正确步骤：
1. 启动 Electron 应用
2. 打开 Chrome 浏览器
3. 访问 `chrome://inspect/#devices`
4. 点击 "inspect" 打开 DevTools
5. 在打开的 DevTools 中查看网络请求

### Q2: WebSocket connection failed 怎么办？

**错误信息：**
```
sdk.js:1 WebSocket connection to 'ws://localhost:9222/devtools/page/xxx' failed
```

**原因：** 直接在浏览器中访问 `http://localhost:9222`，而不是通过 Chrome inspect。

**解决方案：**
- ❌ 不要直接访问 `http://localhost:9222`
- ✅ 使用 `chrome://inspect/#devices`
- ✅ 或者直接访问 `http://localhost:5173` 进行前端调试

### Q3: 应该用哪个端口调试？

**快速决策树：**
```
需要调试什么？
├─ 前端界面/样式/逻辑
│  └─ 使用 localhost:5173（浏览器直接访问）
│
├─ Electron 桌面功能/主进程
│  └─ 使用 localhost:9222（Chrome inspect 连接）
│
└─ API 请求/响应
   └─ 使用 localhost:5173（更方便）
```

### Q4: 我通过 localhost:5173 看到的和 Electron 中的一样吗？

**A:** 基本一样，但有细微差别：

| 特性 | localhost:5173（浏览器） | Electron 应用 |
|------|------------------------|--------------|
| Vue 应用 | ✅ 完全相同 | ✅ 完全相同 |
| API 调用 | ✅ 相同 | ✅ 相同 |
| Node.js API | ❌ 不可用 | ✅ 可用 |
| Electron API | ❌ 不可用 | ✅ 可用 |
| 文件系统 | ❌ 受限 | ✅ 完整访问 |

**结论：** 纯前端逻辑调试用浏览器即可，涉及 Electron/Node 特性时用 Electron 调试。

---

## 💡 最佳实践

### 日常开发流程

```bash
# 阶段 1: 开发前端界面（使用浏览器）
cd frontend
npm run dev
# 访问 http://localhost:5173 进行开发和调试

# 阶段 2: 测试 Electron 集成（使用 Electron）
cd frontend
npm run electron:dev
# 使用 chrome://inspect 连接调试

# 阶段 3: 发布前测试
npm run build
npm run electron:build
# 测试打包后的应用
```

### 调试技巧

1. **前端 API 调试：** 优先使用 localhost:5173
   ```javascript
   // 在浏览器 Console 中直接测试 API
   const api = await import('./src/api/index.ts')
   const health = await api.checkHealth()
   console.log(health)
   ```

2. **查看 Electron 日志：** 启动 Electron 后查看终端输出
   ```bash
   npm run electron:dev
   # 终端会显示：
   # 🔍 远程调试已启用，端口: 9222
   # 📖 在 Chrome 中访问: chrome://inspect/#devices
   ```

3. **同时调试：** 可以同时打开两个调试界面
   ```
   1. 浏览器访问 http://localhost:5173（快速查看）
   2. Chrome inspect 连接 Electron（深度调试）
   3. 对比两者的行为差异
   ```

---

## 🔗 相关文档

- [Vite 官方文档](https://vitejs.dev/)
- [Electron 调试文档](https://www.electronjs.org/docs/latest/tutorial/debugging-main-process)
- [Chrome DevTools Protocol](https://chromedevtools.github.io/devtools-protocol/)

---

## 📝 总结

| 用途 | 推荐端口 | 访问方式 |
|------|---------|---------|
| **前端开发** | 5173 | 浏览器直接访问 |
| **API 调试** | 5173 | 浏览器 DevTools |
| **Electron 调试** | 9222 | Chrome inspect 连接 |
| **生产环境测试** | - | 打包后的应用 |

**记住：99% 的情况下，使用 `http://localhost:5173` 进行前端调试就够了！**


