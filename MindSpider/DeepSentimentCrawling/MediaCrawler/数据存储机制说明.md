# ğŸ“Š MediaCrawler æ•°æ®å­˜å‚¨æœºåˆ¶è¯´æ˜

## ğŸ¯ æ ¸å¿ƒé—®é¢˜è§£ç­”

**Q: ä½¿ç”¨ `python main.py --platform xhs --lt qrcode --type search` ä¼šä¸ä¼šå°†æ•°æ®å®æ—¶å­˜å‚¨åˆ°æ•°æ®åº“ä¸­ï¼Ÿ**

**A: ä¼šçš„ï¼æ•°æ®ä¼šå®æ—¶å­˜å‚¨åˆ°æ•°æ®åº“ã€‚** âœ…

---

## ğŸ” è¯¦ç»†åˆ†æ

### 1. å‘½ä»¤è¡Œå‚æ•°è§£æ

å½“ä½ è¿è¡Œå‘½ä»¤ï¼š
```bash
python main.py --platform xhs --lt qrcode --type search
```

**æ²¡æœ‰æŒ‡å®š `--save_data_option` å‚æ•°**ï¼Œç³»ç»Ÿä¼šä½¿ç”¨é»˜è®¤é…ç½®ã€‚

### 2. é»˜è®¤å­˜å‚¨æ–¹å¼

**ä½ç½®ï¼š** `config/base_config.py:64`

```python
# æ•°æ®ä¿å­˜ç±»å‹é€‰é¡¹é…ç½®ï¼Œæ”¯æŒå…­ç§ç±»å‹ï¼šcsvã€dbã€jsonã€sqliteã€postgresqlã€mongodb
# æœ€å¥½ä¿å­˜åˆ°DBï¼Œæœ‰æ’é‡çš„åŠŸèƒ½
SAVE_DATA_OPTION = "db"  # ğŸ‘ˆ é»˜è®¤ä½¿ç”¨æ•°æ®åº“å­˜å‚¨
```

**ç»“è®ºï¼š** é»˜è®¤æƒ…å†µä¸‹ä½¿ç”¨ **`"db"`** æ¨¡å¼ï¼Œä¼šå­˜å‚¨åˆ°æ•°æ®åº“ã€‚

### 3. å‚æ•°è§£æé€»è¾‘

**ä½ç½®ï¼š** `cmd_arg/arg.py:193-202`

```python
save_data_option: Annotated[
    SaveDataOptionEnum,
    typer.Option(
        "--save_data_option",
        help="æ•°æ®ä¿å­˜æ–¹å¼ (csv | db | json | sqlite | postgresql | mongodb)",
        rich_help_panel="å­˜å‚¨é…ç½®",
    ),
] = _coerce_enum(
    SaveDataOptionEnum, 
    config.SAVE_DATA_OPTION,      # ğŸ‘ˆ ä½¿ç”¨ base_config.py ä¸­çš„å€¼ ("db")
    SaveDataOptionEnum.JSON       # ğŸ‘ˆ åå¤‡é»˜è®¤å€¼ï¼ˆå¾ˆå°‘ç”¨åˆ°ï¼‰
)
```

**å·¥ä½œæµç¨‹ï¼š**
1. æ£€æŸ¥å‘½ä»¤è¡Œæ˜¯å¦æŒ‡å®šäº† `--save_data_option`
2. å¦‚æœæ²¡æœ‰ï¼Œä½¿ç”¨ `config.SAVE_DATA_OPTION`ï¼ˆé»˜è®¤æ˜¯ `"db"`ï¼‰
3. å¦‚æœ `config.SAVE_DATA_OPTION` æ— æ•ˆï¼Œæ‰ä½¿ç”¨åå¤‡å€¼ `JSON`

### 4. å­˜å‚¨å®ç°ç±»

**ä½ç½®ï¼š** `store/xhs/__init__.py:32-55`

```python
class XhsStoreFactory:
    STORES = {
        "csv": XhsCsvStoreImplement,
        "db": XhsDbStoreImplement,           # ğŸ‘ˆ "db" å¯¹åº”è¿™ä¸ªç±»
        "json": XhsJsonStoreImplement,
        "sqlite": XhsSqliteStoreImplement,
        "postgresql": XhsDbStoreImplement,   # ğŸ‘ˆ ä¸ "db" ä½¿ç”¨ç›¸åŒå®ç°
        "mongodb": XhsMongoDBStoreImplement,
    }

    @staticmethod
    def create_store() -> AbstractStore:
        store_class = XhsStoreFactory.STORES.get(config.SAVE_DATA_OPTION)
        return store_class()
```

**è¯´æ˜ï¼š**
- `"db"` å’Œ `"postgresql"` éƒ½ä½¿ç”¨ `XhsDbStoreImplement` ç±»
- å…·ä½“è¿æ¥å“ªä¸ªæ•°æ®åº“ï¼ˆMySQL/PostgreSQLï¼‰ç”± `config/db_config.py` ä¸­çš„ `DB_DIALECT` å†³å®š

---

## âš¡ å®æ—¶å­˜å‚¨æœºåˆ¶

### å­˜å‚¨æµç¨‹

```
çˆ¬å–å°çº¢ä¹¦ç¬”è®°
    â†“
è°ƒç”¨ update_xhs_note()
    â†“
XhsStoreFactory.create_store()  # åˆ›å»ºå­˜å‚¨å®ä¾‹
    â†“
XhsDbStoreImplement.store_content()  # ğŸ”¥ ç«‹å³å­˜å‚¨åˆ°æ•°æ®åº“
    â†“
async with get_session() as session:
    - æ£€æŸ¥ç¬”è®°æ˜¯å¦å·²å­˜åœ¨
    - å¦‚æœå­˜åœ¨ â†’ æ›´æ–°æ•°æ®
    - å¦‚æœä¸å­˜åœ¨ â†’ æ’å…¥æ–°æ•°æ®
    â†“
è‡ªåŠ¨æäº¤äº‹åŠ¡
    â†“
âœ… æ•°æ®å·²ä¿å­˜åˆ°æ•°æ®åº“
```

### æ ¸å¿ƒä»£ç 

**ä½ç½®ï¼š** `store/xhs/_store_impl.py:84-96`

```python
class XhsDbStoreImplement(AbstractStore):
    async def store_content(self, content_item: Dict):
        """å®æ—¶å­˜å‚¨ç¬”è®°æ•°æ®åˆ°æ•°æ®åº“"""
        note_id = content_item.get("note_id")
        if not note_id:
            return
        
        # ğŸ”¥ åˆ›å»ºæ•°æ®åº“ä¼šè¯ï¼Œè‡ªåŠ¨ç®¡ç†äº‹åŠ¡
        async with get_session() as session:
            # æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨ï¼ˆå»é‡ï¼‰
            if await self.content_is_exist(session, note_id):
                # å·²å­˜åœ¨ â†’ æ›´æ–°äº’åŠ¨æ•°æ®
                await self.update_content(session, content_item)
            else:
                # ä¸å­˜åœ¨ â†’ æ’å…¥æ–°æ•°æ®
                await self.add_content(session, content_item)
        
        # âœ… é€€å‡º context manager æ—¶è‡ªåŠ¨æäº¤äº‹åŠ¡
```

**ä½ç½®ï¼š** `store/xhs/_store_impl.py:146-156`

```python
async def store_comment(self, comment_item: Dict):
    """å®æ—¶å­˜å‚¨è¯„è®ºæ•°æ®åˆ°æ•°æ®åº“"""
    if not comment_item:
        return
    
    async with get_session() as session:
        comment_id = comment_item.get("comment_id")
        if not comment_id:
            return
        
        # æ£€æŸ¥è¯„è®ºæ˜¯å¦å·²å­˜åœ¨
        if await self.comment_is_exist(session, comment_id):
            await self.update_comment(session, comment_item)
        else:
            await self.add_comment(session, comment_item)
    
    # âœ… è‡ªåŠ¨æäº¤äº‹åŠ¡
```

### å…³é”®ç‰¹æ€§

#### âœ… å®æ—¶æ€§
- **æ¯çˆ¬å–ä¸€æ¡æ•°æ®ï¼Œç«‹å³å­˜å‚¨**
- ä¸éœ€è¦ç­‰å¾…çˆ¬å–å®Œæˆ
- å³ä½¿ç¨‹åºä¸­æ–­ï¼Œå·²çˆ¬å–çš„æ•°æ®ä¹Ÿå·²ä¿å­˜

#### âœ… å»é‡åŠŸèƒ½
- é€šè¿‡ `note_id` æˆ– `comment_id` åˆ¤æ–­æ˜¯å¦å·²å­˜åœ¨
- å·²å­˜åœ¨çš„æ•°æ®ä¼šæ›´æ–°ï¼ˆä¾‹å¦‚ç‚¹èµæ•°ã€è¯„è®ºæ•°ç­‰äº’åŠ¨æ•°æ®ï¼‰
- é¿å…é‡å¤å­˜å‚¨

#### âœ… äº‹åŠ¡å®‰å…¨
- ä½¿ç”¨ `async with get_session()` ç®¡ç†æ•°æ®åº“ä¼šè¯
- è‡ªåŠ¨æäº¤äº‹åŠ¡ï¼ˆæˆåŠŸæ—¶ï¼‰
- è‡ªåŠ¨å›æ»šï¼ˆå¤±è´¥æ—¶ï¼‰

---

## ğŸ“Š æ”¯æŒçš„å­˜å‚¨æ–¹å¼å¯¹æ¯”

| å­˜å‚¨æ–¹å¼ | å‚æ•°å€¼ | å®æ—¶æ€§ | å»é‡ | æ¨èåœºæ™¯ |
|---------|--------|-------|------|---------|
| **MySQL æ•°æ®åº“** | `db` | âœ… å®æ—¶ | âœ… æ”¯æŒ | ç”Ÿäº§ç¯å¢ƒã€é•¿æœŸå­˜å‚¨ |
| **PostgreSQL** | `postgresql` | âœ… å®æ—¶ | âœ… æ”¯æŒ | å¤§æ•°æ®åˆ†æã€æ—¶åºæ•°æ® |
| **MongoDB** | `mongodb` | âœ… å®æ—¶ | âœ… æ”¯æŒ | çµæ´»schemaã€æµ·é‡æ•°æ® |
| **SQLite** | `sqlite` | âœ… å®æ—¶ | âœ… æ”¯æŒ | æœ¬åœ°æµ‹è¯•ã€å°è§„æ¨¡çˆ¬å– |
| **CSV æ–‡ä»¶** | `csv` | âš ï¸ å»¶è¿Ÿ | âŒ ä¸æ”¯æŒ | æ•°æ®å¯¼å‡ºã€ç®€å•åˆ†æ |
| **JSON æ–‡ä»¶** | `json` | âš ï¸ å»¶è¿Ÿ | âŒ ä¸æ”¯æŒ | æ•°æ®å¯¼å‡ºã€æ ¼å¼è½¬æ¢ |

**æ¨èï¼š** ä½¿ç”¨æ•°æ®åº“å­˜å‚¨ï¼ˆ`db`/`postgresql`/`mongodb`ï¼‰ï¼Œå…·æœ‰å®æ—¶æ€§å’Œå»é‡åŠŸèƒ½ã€‚

---

## ğŸ¨ ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹ 1ï¼šä½¿ç”¨é»˜è®¤æ•°æ®åº“å­˜å‚¨ï¼ˆæ¨èï¼‰

```bash
# ä¸æŒ‡å®š --save_data_optionï¼Œé»˜è®¤ä½¿ç”¨ "db"
python main.py --platform xhs --lt qrcode --type search

# ç­‰ä»·äºæ˜¾å¼æŒ‡å®š
python main.py --platform xhs --lt qrcode --type search --save_data_option db
```

**å­˜å‚¨åˆ°å“ªä¸ªæ•°æ®åº“ï¼Ÿ**
- ç”± `MindSpider/config.py` ä¸­çš„ `DB_DIALECT` å†³å®š
- `DB_DIALECT=mysql` â†’ å­˜å‚¨åˆ° MySQL
- `DB_DIALECT=postgresql` â†’ å­˜å‚¨åˆ° PostgreSQL

**æ•°æ®åº“é…ç½®ï¼š**
- ä¸»æœºï¼š`DB_HOST`ï¼ˆä¾‹å¦‚ `localhost`ï¼‰
- ç«¯å£ï¼š`DB_PORT`ï¼ˆMySQL: 3306, PostgreSQL: 5432ï¼‰
- æ•°æ®åº“åï¼š`DB_NAME`ï¼ˆä¾‹å¦‚ `xhs`ï¼‰
- ç”¨æˆ·å/å¯†ç ï¼š`DB_USER` / `DB_PASSWORD`

---

### ç¤ºä¾‹ 2ï¼šä½¿ç”¨ PostgreSQL å­˜å‚¨

```bash
# æ˜¾å¼æŒ‡å®š PostgreSQL
python main.py --platform xhs --lt qrcode --type search --save_data_option postgresql
```

**é…ç½®è¦æ±‚ï¼š**
```bash
# .env æ–‡ä»¶æˆ–ç¯å¢ƒå˜é‡
DB_HOST=localhost
DB_PORT=5432
DB_USER=postgres
DB_PASSWORD=your_password
DB_NAME=xhs
```

---

### ç¤ºä¾‹ 3ï¼šä½¿ç”¨ MongoDB å­˜å‚¨

```bash
# æ˜¾å¼æŒ‡å®š MongoDB
python main.py --platform xhs --lt qrcode --type search --save_data_option mongodb
```

**å‰ææ¡ä»¶ï¼š**
1. å®‰è£… MongoDB é©±åŠ¨ï¼š`pip install motor==3.3.2`
2. åˆå§‹åŒ– MongoDB ç´¢å¼•ï¼š`python main.py --init_db mongodb`

**é…ç½®è¦æ±‚ï¼š**
```bash
# .env æ–‡ä»¶
DB_HOST=localhost
DB_PORT=27017
DB_USER=root
DB_PASSWORD=your_password
DB_NAME=xhs
```

---

### ç¤ºä¾‹ 4ï¼šä½¿ç”¨ CSV æ–‡ä»¶å­˜å‚¨

```bash
# å­˜å‚¨ä¸º CSV æ–‡ä»¶
python main.py --platform xhs --lt qrcode --type search --save_data_option csv
```

**ç‰¹ç‚¹ï¼š**
- âš ï¸ **ä¸æ˜¯å®æ—¶çš„**ï¼šæ•°æ®åœ¨ç¨‹åºç»“æŸæ—¶æ‰å†™å…¥æ–‡ä»¶
- âŒ **ä¸å»é‡**ï¼šé‡å¤è¿è¡Œä¼šé‡å¤ä¿å­˜æ•°æ®
- ğŸ“ **æ–‡ä»¶ä½ç½®**ï¼š`data/xhs/` ç›®å½•ä¸‹
- ğŸ’¾ **æ–‡ä»¶å**ï¼š`xhs_notes_YYYYMMDD.csv`ã€`xhs_comments_YYYYMMDD.csv`

**é€‚ç”¨åœºæ™¯ï¼š**
- æ•°æ®å¯¼å‡º
- ä¸€æ¬¡æ€§çˆ¬å–
- ä¸éœ€è¦å»é‡çš„åœºæ™¯

---

### ç¤ºä¾‹ 5ï¼šä½¿ç”¨ JSON æ–‡ä»¶å­˜å‚¨

```bash
# å­˜å‚¨ä¸º JSON æ–‡ä»¶
python main.py --platform xhs --lt qrcode --type search --save_data_option json
```

**ç‰¹ç‚¹ï¼š**
- âš ï¸ **ä¸æ˜¯å®æ—¶çš„**
- âŒ **ä¸å»é‡**
- ğŸ“ **æ–‡ä»¶ä½ç½®**ï¼š`data/xhs/` ç›®å½•ä¸‹
- ğŸ’¾ **æ–‡ä»¶å**ï¼š`xhs_notes_YYYYMMDD.json`ã€`xhs_comments_YYYYMMDD.json`

---

## ğŸ”§ æ•°æ®åº“ä¼šè¯ç®¡ç†

### ä¼šè¯ç”Ÿå‘½å‘¨æœŸ

**ä½ç½®ï¼š** `database/db_session.py`

```python
@asynccontextmanager
async def get_session() -> AsyncSession:
    """
    è·å–æ•°æ®åº“ä¼šè¯
    - è‡ªåŠ¨ç®¡ç†è¿æ¥
    - è‡ªåŠ¨æäº¤äº‹åŠ¡
    - è‡ªåŠ¨å›æ»šï¼ˆå‡ºé”™æ—¶ï¼‰
    """
    async_engine = get_engine()
    async_session_maker = async_sessionmaker(
        bind=async_engine, 
        expire_on_commit=False
    )
    
    async with async_session_maker() as session:
        try:
            yield session
            await session.commit()  # âœ… è‡ªåŠ¨æäº¤
        except Exception as e:
            await session.rollback()  # âš ï¸ å‡ºé”™æ—¶å›æ»š
            raise e
```

**ä½¿ç”¨ç¤ºä¾‹ï¼š**

```python
# æ¯æ¬¡å­˜å‚¨æ•°æ®éƒ½ä¼šåˆ›å»ºæ–°çš„ä¼šè¯
async with get_session() as session:
    note = XhsNote(note_id="123", title="æµ‹è¯•")
    session.add(note)
    # é€€å‡º context manager æ—¶è‡ªåŠ¨æäº¤
```

---

## ğŸ“‹ æ•°æ®è¡¨ç»“æ„

### å°çº¢ä¹¦ç¬”è®°è¡¨ (`xhs_note`)

**ä½ç½®ï¼š** `database/models.py`

```python
class XhsNote(Base):
    __tablename__ = "xhs_note"
    
    id = Column(Integer, primary_key=True, autoincrement=True)
    note_id = Column(String, nullable=False, unique=True, index=True)  # ç¬”è®°IDï¼ˆå»é‡ï¼‰
    user_id = Column(String)           # ç”¨æˆ·ID
    nickname = Column(String)          # ç”¨æˆ·æ˜µç§°
    title = Column(String)             # ç¬”è®°æ ‡é¢˜
    desc = Column(Text)                # ç¬”è®°å†…å®¹
    liked_count = Column(String)       # ç‚¹èµæ•°
    comment_count = Column(String)     # è¯„è®ºæ•°
    source_keyword = Column(String)    # æœç´¢å…³é”®è¯
    add_ts = Column(Integer)           # é¦–æ¬¡æŠ“å–æ—¶é—´
    last_modify_ts = Column(Integer)   # æœ€åæ›´æ–°æ—¶é—´
    # ... æ›´å¤šå­—æ®µ
```

**ä¸»é”®å’Œç´¢å¼•ï¼š**
- `id`ï¼šè‡ªå¢ä¸»é”®
- `note_id`ï¼šå”¯ä¸€ç´¢å¼•ï¼ˆç”¨äºå»é‡ï¼‰

### å°çº¢ä¹¦è¯„è®ºè¡¨ (`xhs_note_comment`)

```python
class XhsNoteComment(Base):
    __tablename__ = "xhs_note_comment"
    
    id = Column(Integer, primary_key=True, autoincrement=True)
    comment_id = Column(String, nullable=False, unique=True, index=True)  # è¯„è®ºIDï¼ˆå»é‡ï¼‰
    note_id = Column(String, index=True)  # ç¬”è®°IDï¼ˆå¤–é”®å…³è”ï¼‰
    user_id = Column(String)              # è¯„è®ºç”¨æˆ·ID
    content = Column(Text)                # è¯„è®ºå†…å®¹
    like_count = Column(Integer)          # ç‚¹èµæ•°
    create_time = Column(Integer)         # è¯„è®ºæ—¶é—´
    # ... æ›´å¤šå­—æ®µ
```

---

## ğŸ’¡ æœ€ä½³å®è·µ

### âœ… æ¨èåšæ³•

#### 1. ä½¿ç”¨æ•°æ®åº“å­˜å‚¨ï¼ˆé»˜è®¤ï¼‰

```bash
# æ–¹å¼ Aï¼šä½¿ç”¨é»˜è®¤é…ç½®ï¼ˆæ¨èï¼‰
python main.py --platform xhs --lt qrcode --type search

# æ–¹å¼ Bï¼šæ˜¾å¼æŒ‡å®šæ•°æ®åº“
python main.py --platform xhs --lt qrcode --type search --save_data_option db
```

**ä¼˜åŠ¿ï¼š**
- âœ… å®æ—¶å­˜å‚¨ï¼Œæ•°æ®å®‰å…¨
- âœ… è‡ªåŠ¨å»é‡ï¼Œé¿å…é‡å¤
- âœ… æ”¯æŒæŸ¥è¯¢å’Œåˆ†æ
- âœ… é€‚åˆé•¿æœŸè¿è¡Œ

#### 2. å®šæœŸè¿è¡Œï¼Œå¢é‡çˆ¬å–

```bash
# æ¯å¤©è¿è¡Œï¼Œæ•°æ®åº“ä¼šè‡ªåŠ¨å»é‡
# ç¬¬ä¸€å¤©
python main.py --platform xhs --type search
# çˆ¬å– 100 æ¡ç¬”è®°ï¼Œå­˜å‚¨åˆ°æ•°æ®åº“

# ç¬¬äºŒå¤©
python main.py --platform xhs --type search
# çˆ¬å– 120 æ¡ç¬”è®°ï¼ˆåŒ…å« 20 æ¡æ–°ç¬”è®° + 100 æ¡æ—§ç¬”è®°ï¼‰
# æ—§ç¬”è®°ä¼šæ›´æ–°äº’åŠ¨æ•°æ®ï¼Œæ–°ç¬”è®°ä¼šæ’å…¥
```

#### 3. é…ç½®åˆç†çš„æ•°æ®åº“

```python
# config/db_config.py æˆ– .env
DB_HOST=localhost
DB_PORT=3306
DB_USER=root
DB_PASSWORD=strong_password
DB_NAME=xhs
DB_CHARSET=utf8mb4  # æ”¯æŒ emoji
```

---

### âŒ ä¸æ¨èåšæ³•

#### 1. é•¿æœŸä½¿ç”¨ CSV/JSON å­˜å‚¨

```bash
# âŒ ä¸æ¨èï¼šCSV ä¸å»é‡ï¼Œä¼šé‡å¤å­˜å‚¨
python main.py --platform xhs --type search --save_data_option csv
```

**é—®é¢˜ï¼š**
- æ•°æ®é‡å¤
- æ–‡ä»¶è¶Šæ¥è¶Šå¤§
- éš¾ä»¥æŸ¥è¯¢å’Œåˆ†æ

#### 2. ä¸æ£€æŸ¥æ•°æ®åº“é…ç½®å°±è¿è¡Œ

```bash
# âŒ ä¸æ¨èï¼šæœªæ£€æŸ¥æ•°æ®åº“æ˜¯å¦å¯ç”¨
python main.py --platform xhs --type search
```

**å¯èƒ½çš„é”™è¯¯ï¼š**
```
æ•°æ®åº“è¿æ¥å¤±è´¥: Can't connect to MySQL server
```

**æ­£ç¡®åšæ³•ï¼š**
```bash
# 1. å…ˆæµ‹è¯•æ•°æ®åº“è¿æ¥
python main.py --init_db mysql

# 2. ç¡®è®¤è¿æ¥æˆåŠŸåå†çˆ¬å–
python main.py --platform xhs --type search
```

---

## ğŸ” å¦‚ä½•éªŒè¯æ•°æ®æ˜¯å¦å®æ—¶å­˜å‚¨ï¼Ÿ

### æ–¹æ³• 1ï¼šå®æ—¶æŸ¥çœ‹æ•°æ®åº“

```bash
# ç»ˆç«¯ 1ï¼šè¿è¡Œçˆ¬è™«
cd MindSpider/DeepSentimentCrawling/MediaCrawler
python main.py --platform xhs --lt qrcode --type search

# ç»ˆç«¯ 2ï¼šå®æ—¶æŸ¥è¯¢æ•°æ®åº“
mysql -u root -p
USE xhs;

# æ¯éš”å‡ ç§’æ‰§è¡Œä¸€æ¬¡ï¼Œä¼šçœ‹åˆ°æ•°æ®å®æ—¶å¢åŠ 
SELECT COUNT(*) FROM xhs_note;
SELECT note_id, title, liked_count FROM xhs_note ORDER BY id DESC LIMIT 5;
```

### æ–¹æ³• 2ï¼šæŸ¥çœ‹æ—¥å¿—è¾“å‡º

```bash
python main.py --platform xhs --type search

# æ—¥å¿—ä¼šæ˜¾ç¤ºå®æ—¶å­˜å‚¨ä¿¡æ¯ï¼š
# [store.xhs.update_xhs_note] xhs note: {'note_id': '123', 'title': 'æµ‹è¯•ç¬”è®°', ...}
# [XhsDbStoreImplement] Inserted new note: 123
```

### æ–¹æ³• 3ï¼šç¨‹åºä¸­æ–­åæ£€æŸ¥

```bash
# 1. å¯åŠ¨çˆ¬è™«
python main.py --platform xhs --type search

# 2. çˆ¬å–ä¸€æ®µæ—¶é—´åæŒ‰ Ctrl+C ä¸­æ–­

# 3. æ£€æŸ¥æ•°æ®åº“
mysql -u root -p
USE xhs;
SELECT COUNT(*) FROM xhs_note;
# ğŸ¯ å·²çˆ¬å–çš„æ•°æ®éƒ½åœ¨æ•°æ®åº“ä¸­ï¼
```

---

## ğŸ“Š æ€»ç»“

### æ ¸å¿ƒè¦ç‚¹

âœ… **å®æ—¶å­˜å‚¨**
- æ¯çˆ¬å–ä¸€æ¡æ•°æ®ï¼Œç«‹å³å­˜å‚¨åˆ°æ•°æ®åº“
- ä¸éœ€è¦ç­‰å¾…çˆ¬å–å®Œæˆ
- ç¨‹åºä¸­æ–­ä¸ä¼šä¸¢å¤±å·²çˆ¬å–çš„æ•°æ®

âœ… **è‡ªåŠ¨å»é‡**
- é€šè¿‡ `note_id` / `comment_id` åˆ¤æ–­æ˜¯å¦å·²å­˜åœ¨
- å·²å­˜åœ¨çš„æ•°æ®ä¼šæ›´æ–°äº’åŠ¨æ•°æ®
- ä¸ä¼šé‡å¤æ’å…¥ç›¸åŒçš„ç¬”è®°/è¯„è®º

âœ… **é»˜è®¤è¡Œä¸º**
- ä¸æŒ‡å®š `--save_data_option` æ—¶ï¼Œé»˜è®¤ä½¿ç”¨ `"db"` æ¨¡å¼
- å­˜å‚¨åˆ° MySQL æˆ– PostgreSQLï¼ˆæ ¹æ®é…ç½®ï¼‰

âœ… **äº‹åŠ¡å®‰å…¨**
- ä½¿ç”¨æ•°æ®åº“äº‹åŠ¡ç¡®ä¿æ•°æ®ä¸€è‡´æ€§
- å¤±è´¥æ—¶è‡ªåŠ¨å›æ»š

---

## ğŸ¯ å›ç­”ä½ çš„é—®é¢˜

**Q: ä½¿ç”¨ `python main.py --platform xhs --lt qrcode --type search` ä¼šä¸ä¼šå°†æ•°æ®å®æ—¶å­˜å‚¨åˆ°æ•°æ®åº“ä¸­ï¼Ÿ**

**A: ä¼šçš„ï¼å®Œæ•´è§£é‡Šï¼š**

1. âœ… **ä¼šå®æ—¶å­˜å‚¨åˆ°æ•°æ®åº“**
   - é»˜è®¤ä½¿ç”¨ `SAVE_DATA_OPTION = "db"`
   - æ¯çˆ¬å–ä¸€æ¡ç¬”è®°/è¯„è®ºï¼Œç«‹å³å­˜å…¥æ•°æ®åº“

2. âœ… **å­˜å‚¨ä½ç½®**
   - æ ¹æ® `DB_DIALECT` å†³å®šï¼š
     - `DB_DIALECT=mysql` â†’ MySQL æ•°æ®åº“
     - `DB_DIALECT=postgresql` â†’ PostgreSQL æ•°æ®åº“
   - æ•°æ®åº“é…ç½®åœ¨ `.env` æˆ– `config/db_config.py` ä¸­

3. âœ… **å®æ—¶æ€§ä¿è¯**
   - ä½¿ç”¨ `async with get_session()` ç®¡ç†ä¼šè¯
   - æ¯æ¬¡å­˜å‚¨åè‡ªåŠ¨æäº¤äº‹åŠ¡
   - ä¸ä¼šç­‰å¾…æ‰€æœ‰æ•°æ®çˆ¬å–å®Œæ‰å­˜å‚¨

4. âœ… **å»é‡åŠŸèƒ½**
   - é€šè¿‡ `note_id` å”¯ä¸€ç´¢å¼•å»é‡
   - é‡å¤è¿è¡Œä¸ä¼šæ’å…¥é‡å¤æ•°æ®
   - å·²æœ‰æ•°æ®ä¼šæ›´æ–°äº’åŠ¨æ•°ï¼ˆç‚¹èµã€è¯„è®ºç­‰ï¼‰

---

**éœ€è¦æŸ¥çœ‹æ›´å¤šä¿¡æ¯ï¼Ÿ**
- é…ç½®æ–‡ä»¶ï¼š`config/base_config.py`
- å­˜å‚¨å®ç°ï¼š`store/xhs/_store_impl.py`
- æ•°æ®æ¨¡å‹ï¼š`database/models.py`
- æ•°æ®åº“é…ç½®ï¼š`config/db_config.py`

**ç¥ä½ ä½¿ç”¨æ„‰å¿«ï¼** ğŸ‰




